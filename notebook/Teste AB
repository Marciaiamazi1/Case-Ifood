# üìä An√°lise do Teste A/B ‚Äî Case iFood

## 1. Bibliotecas
import pandas as pd
import scipy.stats as stats
import matplotlib.pyplot as plt
import seaborn as sns

## 2. Carregar base j√° unida do ETL
# (suponha que ela foi salva no notebook anterior)
df = pd.read_csv('dados_completos.csv')  # ou use o nome correto caso tenha salvo com outro

## 3. Visualizar estrutura
df['is_target'].value_counts()

## 4. Criar m√©tricas principais

# Filtrar apenas per√≠odo da campanha, se necess√°rio (ex: Jan/2019)
df['order_created_at'] = pd.to_datetime(df['order_created_at'])
df_periodo = df[df['order_created_at'].dt.month == 1]

# Quantos usu√°rios √∫nicos fizeram pedidos por grupo
pedidos_por_usuario = df_periodo.groupby(['customer_id', 'is_target']).agg({
    'order_id': 'count',
    'order_total_amount': 'sum'
}).reset_index()

pedidos_por_usuario.rename(columns={
    'order_id': 'qtd_pedidos',
    'order_total_amount': 'valor_total'
}, inplace=True)

# Estat√≠sticas gerais
pedidos_por_usuario.groupby('is_target').agg({
    'qtd_pedidos': ['mean', 'median'],
    'valor_total': ['mean', 'median']
})

## 5. Testes Estat√≠sticos

# Separar os grupos
grupo_target = pedidos_por_usuario[pedidos_por_usuario['is_target'] == 'target']
grupo_controle = pedidos_por_usuario[pedidos_por_usuario['is_target'] == 'control']

# Teste de m√©dia de pedidos por usu√°rio
stat, p = stats.ttest_ind(
    grupo_target['qtd_pedidos'],
    grupo_controle['qtd_pedidos'],
    equal_var=False
)
print(f'Teste de pedidos por usu√°rio ‚Äî p-valor: {p:.4f}')

# Teste de valor total por usu√°rio
stat2, p2 = stats.ttest_ind(
    grupo_target['valor_total'],
    grupo_controle['valor_total'],
    equal_var=False
)
print(f'Teste de valor total por usu√°rio ‚Äî p-valor: {p2:.4f}')
